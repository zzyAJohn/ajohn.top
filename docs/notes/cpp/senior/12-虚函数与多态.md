---
title: 12. 虚函数与多态
createTime: 2025/09/06 09:04:35
permalink: /cpp/zblh5lnj/
---

@[pdf 96](https://oss.ajohn.top/blog/pdf/oop1.pdf)

## 12.1 Inheritance (继承) with virtual functions (虛函数)

- non-virtual 函数：你不希望derived class 重新定义 (override, 覆写) 它.

- virtual 函数：你==希望==derived class 重新定义 (override, 覆写) 它，且你对它已有默认定义。

- pure virtual 函数：你希望 derived class ==一定==要重新定义 (override, 覆写) 它，你对它没有默认定义

>详情见《Effective C++》条款34：区分接口继承和实现继承

## 12.2 Inheritance (继承) with virtual

前人实现了一个 CDocument ，把固定可以写的先写好，特殊化的操作留到 Serialize ，留给子类自己实现

CMyDoc 继承 CDocument ，仅需要根据自己的需求实现 Serialize 即可，这种写法是设计模式的Template Method。

@startuml
abstract class CDocument {
  +OnFileOpen()
  {abstract}+Serialize()
}

class CMyDoc {
  +Serialize()
}

CDocument <|-- CMyDoc
@enduml

## 12.3 Inheritance + Composition 关系下的构造和析构

### 12.3.1 派生类内部有复合

:::: card-grid

@startuml
skinparam rectangle {
  roundCorner 25
}

rectangle "Base"
rectangle "Derived"
rectangle "Component"

Base <|-- Derived
Derived *--> Component
@enduml



::: card title="Derived"
::: card title="Base & Component"
:::

::::

构造由内而外，Derived 的构造函数首先调用 Base 的 default 构造函数，然后调用 Component 的 default 构造函数，最后才执行自己。

析构由外而内，Derived 的析构函数首先执行自己，然后调用 Component 的析构函数，最后调用 Base 的析构函数。

### 12.3.2 基类内部有复合

:::: card-grid

@startuml
skinparam rectangle {
  roundCorner 25
}

rectangle "Base"
rectangle "Derived"
rectangle "Component"

Base <|-- Derived
Base *--> Component
@enduml

::: card title="Derived"
::: card title="Base"
::: card title="Component"
:::

::::

这种就比较直观，构造由内而外，析构由外而内

